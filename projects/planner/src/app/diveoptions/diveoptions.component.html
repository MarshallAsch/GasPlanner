<div class="card">
    <div class="card-header">
        <div class="float-start">
            <fa-icon [icon]="icon" class="me-3"></fa-icon>
            <span>Options</span>
        </div>
        <div class="float-end">
            <div class="form-check form-switch">
                <input type="checkbox" class="form-check-input" id="isComplex" [checked]="isComplex"
                    (change)="isComplex = !isComplex" mdbCheckbox />
                <label class="custom-control-label" for="isComplex">Extended (Trimix)</label>
            </div>
        </div>
    </div>
    <div class="card-body">
        <form [formGroup]="optionsForm">
            <div *ngIf="!isComplex">
                <div class="mt-3 row">
                    <div class="mb-2 col-auto">
                        <app-gradients [gfLow]="options.gfLow" [gfHigh]="options.gfHigh"
                            (inputChange)="updateGradients($event)" [simple]="true" [showTitle]="true"></app-gradients>
                    </div>
                    <div class="mb-2 col-auto">
                        <app-salinity [salinity]="options.salinity" (inputChange)="salinityChanged($event)">
                        </app-salinity>
                    </div>

                    <div class="mb-2 col-auto">
                        <app-altitude [altitude]="options.altitude" (inputChange)="altitudeChanged($event)">
                        </app-altitude>
                    </div>
                </div>
            </div>

            <!-- Complex UI only -->
            <div *ngIf="isComplex">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="environment-tab" data-bs-toggle="tab"
                            data-bs-target="#environment" type="button" role="tab" aria-controls="environment"
                            aria-selected="true">Environment</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="conservatism-tab" data-bs-toggle="tab"
                            data-bs-target="#conservatism" type="button" role="tab" aria-controls="conservatism"
                            aria-selected="false">Conservatism</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="gases-tab" data-bs-toggle="tab" data-bs-target="#gases"
                            type="button" role="tab" aria-controls="gases" aria-selected="false">Gases</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="stops-tab" data-bs-toggle="tab" data-bs-target="#stops"
                            type="button" role="tab" aria-controls="stops" aria-selected="false">Stops</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="speeds-tab" data-bs-toggle="tab" data-bs-target="#speeds"
                            type="button" role="tab" aria-controls="speeds" aria-selected="false">Speeds</button>
                    </li>
                </ul>

                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="environment" role="tabpanel"
                        aria-labelledby="environment-tab">
                        <div class="mt-3">
                            <div class="mb-2">
                                <app-altitude [altitude]="options.altitude" (inputChange)="altitudeChanged($event)">
                                </app-altitude>
                            </div>
                            <div class="mb-2">
                                <app-salinity [salinity]="options.salinity" (inputChange)="salinityChanged($event)">
                                </app-salinity>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="conservatism" role="tabpanel" aria-labelledby="conservatism-tab">
                        <div class="col-sm mt-3">
                            <app-gradients [gfLow]="options.gfLow" [gfHigh]="options.gfHigh"
                                (inputChange)="updateGradients($event)" [simple]="false" [showTitle]="false">
                            </app-gradients>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="gases" role="tabpanel" aria-labelledby="gases-tab">
                        <div class="row mt-3">
                            <div class="mb-2 col-auto">
                                <label for="maxNarcoticDepth" class="form-label">Maximum narcotic depth
                                    [{{units.length}}]:
                                    <input id="maxNarcoticDepth" class="form-control col-auto" type="number"
                                        formControlName="maxEND" required [min]="ranges.narcoticDepth[0]"
                                        [max]="ranges.narcoticDepth[1]" step="1"
                                        [class.is-invalid]="narcoticDepthInvalid" (input)="applyOptions()" />
                                    <div class="text-danger form-text" *ngIf="narcoticDepthInvalid">
                                        Needs to be number {{ranges.narcoticDepthLabel}}
                                    </div>
                                </label>
                            </div>
                            <div class="row ms-4">
                                <div class="form-check form-switch pb-1">
                                    <input type="checkbox" class="form-check-input" id="oxygenNarcotic" mdbCheckbox
                                        [checked]="options.oxygenNarcotic" (change)="switchOxygenNarcotic()" />
                                    <label class="form-check-label" for="roundStops">Oxygen is narcotic</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="stops" role="tabpanel" aria-labelledby="stops-tab">
                        <div class="row mt-3">
                            <div class="mb-2 col-auto">
                                <label for="problem" class="form-label">Problem solving duration [min]:
                                    <input id="problem" formControlName="problem" class="form-control col-auto"
                                        type="number" (input)="applyOptions()" required [min]="1" [max]="100" min="1"
                                        max="100" step="1" [class.is-invalid]="problemInvalid" />
                                    <div class="text-danger form-text" *ngIf="problemInvalid">
                                        Needs to be number 1 - 100 mim
                                    </div>
                                </label>
                            </div>
                            <div class="mb-2 col-auto">
                                <label for="switchDuration" class="form-label">Gas switch duration [min]:
                                    <input id="switchDuration" formControlName="gasSwitch" class="form-control col-auto"
                                        type="number" required min="1" max="10" step="1" (input)="applyOptions()"
                                        [class.is-invalid]="switchDurationInvalid" />
                                    <div class="text-danger form-text" *ngIf="switchDurationInvalid">
                                        Needs to be number 1 - 10 min
                                    </div>
                                </label>
                            </div>
                            <div class="mb-2 col-auto">
                                <label for="safetyStop" class="form-label">Add 3 min safety stop:
                                    <div class="input-group gradients-max-width">
                                        <div class="input-group dropdown" mdbDropdown>
                                            <input id="safetyStop" [value]="safetyStopOption"
                                                class="form-control col-auto" type="text" readonly />
                                            <button type="button"
                                                class="btn btn-default dropdown-toggle dropdown-toggle-split"
                                                id="safetyStopMenu" aria-expanded="false" data-mdb-toggle="dropdown"
                                                mdbDropdownToggle></button>
                                            <ul class="dropdown-menu dropdown-menu-end" mdbDropdownMenu>
                                                <li (click)="useSafetyOff()"><a class="dropdown-item">{{safetyOffName}}</a></li>
                                                <li (click)="useSafetyAuto()"><a class="dropdown-item">{{safetyAutoName}}</a></li>
                                                <li (click)="useSafetyOn()"><a class="dropdown-item">{{safetyOnName}}</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </label>
                            </div>
                            <div class="mb-2 col-auto">
                                <label for="lastStop" class="form-label">Last stop depth [{{units.length}}]:
                                    <input id="lastStop" (input)="applyOptions()" formControlName="lastStopDepth"
                                        class="form-control col-auto" type="number" required
                                        [min]="ranges.lastStopDepth[0]" [max]="ranges.lastStopDepth[1]" step="1"
                                        [class.is-invalid]="lastStopInvalid" />
                                    <div class="text-danger form-text" *ngIf="lastStopInvalid">
                                        Needs to be number {{ranges.lastStopDepthLabel}}
                                    </div>
                                </label>
                            </div>
                            <div class="row ms-4">
                                <div class="form-check form-switch pb-1">
                                    <input type="checkbox" class="form-check-input" id="roundStops" mdbCheckbox
                                        [checked]="options.roundStopsToMinutes" (change)="switchStopsRounding()" />
                                    <label class="form-check-label" for="roundStops">Round deco stops to minutes</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade container" id="speeds" role="tabpanel" aria-labelledby="speeds-tab">
                        <div class="row mt-3">
                            <div class="mb-2 col-auto">
                                <label for="descSpeed" class="form-label">Descent speed [{{units.speed}}]:
                                    <input id="descSpeed" formControlName="descentSpeed" class="form-control col-auto"
                                        type="number" (input)="applyOptions()" required [min]="ranges.speed[0]"
                                        [max]="ranges.speed[1]" step="1" [class.is-invalid]="descSpeedInvalid" />
                                    <div class="text-danger form-text" *ngIf="descSpeedInvalid">
                                        Needs to be number {{ranges.speedLabel}}
                                    </div>
                                </label>
                            </div>
                            <div class="mb-2 col-auto">
                                <label for="ascSpeed" class="form-label">Ascent {{units.lastSpeedLevel}}
                                    {{units.length}} to surface [{{units.speed}}]:
                                    <input id="ascSpeed" formControlName="ascentSpeed6m" class="form-control col-auto"
                                        type="number" (input)="applyOptions()" required [min]="ranges.speed[0]"
                                        [max]="ranges.speed[1]" step="1" [class.is-invalid]="ascSpeedInvalid" />
                                    <div class="text-danger form-text" *ngIf="ascSpeedInvalid">
                                        Needs to be number {{ranges.speedLabel}}
                                    </div>
                                </label>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="mb-2 col-auto">
                                <label for="ascSpeed2" class="form-label">Ascent up to {{units.lastSpeedLevel}}
                                    {{units.length}} depth [{{units.speed}}]:
                                    <input id="ascSpeed2" (input)="applyOptions()"
                                        formControlName="ascentSpeed50percTo6m" class="form-control col-auto"
                                        type="number" required [min]="ranges.speed[0]" [max]="ranges.speed[1]" step="1"
                                        [class.is-invalid]="ascentSpeed50percTo6mInvalid" />
                                    <div class="text-danger form-text" *ngIf="ascentSpeed50percTo6mInvalid">
                                        Needs to be number {{ranges.speedLabel}}
                                    </div>
                                </label>
                            </div>
                            <div class="mb-2 col-auto">
                                <label for="ascSpeed3" class="form-label">Ascent up to 50% depth [{{units.speed}}]:
                                    <input id="ascSpeed3" formControlName="ascentSpeed50perc"
                                        class="form-control col-auto" type="number" (input)="applyOptions()" required
                                        [min]="ranges.speed[0]" [max]="ranges.speed[1]" step="1"
                                        [class.is-invalid]="ascentSpeed50percInvalid" />
                                    <div class="text-danger form-text" *ngIf="ascentSpeed50percInvalid">
                                        Needs to be number {{ranges.speedLabel}}
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <button type="button" class="btn btn-secondary me-2 mt-3"
                    (click)="useRecreational()">Recreational</button>
                <button type="button" class="btn btn-secondary mt-3" (click)="useRecommended()">Recommended</button>
            </div>
        </form>
    </div>
</div>
